From f934a19a84288b4ae8cb556ccadff26d3ae17588 Mon Sep 17 00:00:00 2001
From: Samuel Macleod <smacleod@cloudflare.com>
Date: Thu, 19 Jan 2023 15:47:52 +0000
Subject: [PATCH 04/15] Better Firefox support for network tab

---
 front_end/entrypoints/js_app/js_app.ts               | 2 ++
 front_end/ui/legacy/components/data_grid/DataGrid.ts | 5 +++++
 2 files changed, 7 insertions(+)

diff --git a/front_end/entrypoints/js_app/js_app.ts b/front_end/entrypoints/js_app/js_app.ts
index 64fa67a316..25a459f122 100644
--- a/front_end/entrypoints/js_app/js_app.ts
+++ b/front_end/entrypoints/js_app/js_app.ts
@@ -44,6 +44,8 @@ async function loadSourcesModule(): Promise<typeof Sources> {
   }
   return loadedSourcesModule;
 }
+// This is not supported in Firefox: https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView
+Element.prototype.scrollIntoViewIfNeeded = Element.prototype.scrollIntoView;
 export class JsMainImpl implements Common.Runnable.Runnable {
   static instance(opts: {forceNew: boolean|null} = {forceNew: null}): JsMainImpl {
     const {forceNew} = opts;
diff --git a/front_end/ui/legacy/components/data_grid/DataGrid.ts b/front_end/ui/legacy/components/data_grid/DataGrid.ts
index 93a117e746..5c667b6b77 100644
--- a/front_end/ui/legacy/components/data_grid/DataGrid.ts
+++ b/front_end/ui/legacy/components/data_grid/DataGrid.ts
@@ -217,6 +217,8 @@ export class DataGridImpl<T> extends Common.ObjectWrapper.ObjectWrapper<EventTyp
     this.headerRow = this.dataTableHeadInternal.createChild('tr');
 
     this.dataTableBody = this.dataTable.createChild('tbody');
+    // This is required for Firefox, else Firefox will position the <tbody/> *under* the <thead/>
+    (this.dataTableBody as HTMLElement).style.height = "calc(100% - 27px)"
     this.topFillerRow = (this.dataTableBody.createChild('tr', 'data-grid-filler-row revealed') as HTMLElement);
     UI.ARIAUtils.setHidden(this.topFillerRow, true);
     this.bottomFillerRow = (this.dataTableBody.createChild('tr', 'data-grid-filler-row revealed') as HTMLElement);
@@ -505,6 +507,9 @@ export class DataGridImpl<T> extends Common.ObjectWrapper.ObjectWrapper<EventTyp
   protected setVerticalPadding(top: number, bottom: number, isConstructorTime: boolean = false): void {
     const topPx = top + 'px';
     const bottomPx = (top || bottom) ? bottom + 'px' : 'auto';
+    // Firefox isn't happy with 0 height table rows, so hide them instead
+    this.topFillerRow.classList.toggle('revealed', topPx !== '0px');
+    this.bottomFillerRow.classList.toggle('revealed', bottomPx !== '0px');
     if (this.topFillerRow.style.height === topPx && this.bottomFillerRow.style.height === bottomPx) {
       return;
     }
-- 
2.39.5 (Apple Git-154)

