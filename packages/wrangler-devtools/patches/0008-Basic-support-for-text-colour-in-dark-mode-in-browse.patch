From 679cd7b9e995b4808b2cd150f6de5b9b840ee69c Mon Sep 17 00:00:00 2001
From: Samuel Macleod <smacleod@cloudflare.com>
Date: Mon, 23 Jan 2023 15:12:38 +0000
Subject: [PATCH 08/14] Basic support for text colour in dark mode in browsers
 that don't implement :host-context

---
 front_end/entrypoint_template.html | 37 ++++++++++++++++++++++++------
 1 file changed, 30 insertions(+), 7 deletions(-)

diff --git a/front_end/entrypoint_template.html b/front_end/entrypoint_template.html
index 545f701684..f405fc38bd 100644
--- a/front_end/entrypoint_template.html
+++ b/front_end/entrypoint_template.html
@@ -13,9 +13,35 @@
       background-color: rgb(41 42 45);
     }
   }
+
+  .platform-mac {
+    --monospace-font-size: 11px;
+    --monospace-font-family: menlo, monospace;
+    --source-code-font-size: 11px;
+    --source-code-font-family: menlo, monospace;
+  }
+
+  .platform-windows {
+    --monospace-font-size: 12px;
+    --monospace-font-family: consolas, lucida console, courier new, monospace;
+    --source-code-font-size: 12px;
+    --source-code-font-family: consolas, lucida console, courier new, monospace;
+  }
+
+  .platform-linux {
+    --monospace-font-size: 11px;
+    --monospace-font-family: dejavu sans mono, monospace;
+    --source-code-font-size: 11px;
+    --source-code-font-family: dejavu sans mono, monospace;
+  }
+
+  .-theme-with-dark-background .platform-linux,
+  .-theme-with-dark-background .platform-mac {
+    --override-text-color: rgb(189 198 207);
+  }
 </style>
 <meta http-equiv="Content-Security-Policy"
-  content="object-src 'none'; script-src 'sha256-7cSoIgLSn2W/Jf+ovCaVMDQtS5K1xhtFhl5WQtvvAaQ=' 'self' 'unsafe-eval' https://chrome-devtools-frontend.appspot.com">
+  content="object-src 'none'; script-src 'sha256-nR3ouvAaRD5oAvx24d8aFSv1EH9XKi9uVvoOsvVuW8U=' 'self' 'unsafe-eval' https://chrome-devtools-frontend.appspot.com">
 <meta name="referrer" content="no-referrer">
 <script>
   var supportsCustomElements = false;
@@ -30,16 +56,13 @@
     });
   }
 
+
   if (!supportsCustomElements) {
     // It's not going to work in this browser. Show warning.
+    document.querySelector('html').innerHTML = ''
     document.querySelector('html').style.background = 'url(Images/fake.png) no-repeat top left/1202px 138px';
-  } else {
-    // Load the Devtools app
-    const script = document.createElement("script")
-    script.src = "./entrypoints/%ENTRYPOINT_NAME%/%ENTRYPOINT_NAME%.js"
-    script.type = "module"
-    document.head.append(script)
   }
 </script>
+<script type="module" src="./entrypoints/%ENTRYPOINT_NAME%/%ENTRYPOINT_NAME%.js" defer></script>
 
 <body class="undocked" id="-blink-dev-tools">
\ No newline at end of file
-- 
2.39.5 (Apple Git-154)

